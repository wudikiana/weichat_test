<!--ear-scan-result.wxml-->
<view class="container">
  <!-- 分析结果卡片 -->
  <view class="result-card">
    <view class="result-header">
      <view class="result-icon {{result.hasLesion ? 'warning' : 'success'}}">
        <t-icon name="{{result.hasLesion ? 'warning' : 'check-circle'}}" size="48px" />
      </view>
      <text class="result-title">分析完成</text>
      <text class="result-status">整体状况：<text class="status-text {{result.hasLesion ? 'warning' : 'success'}}">{{result.overallStatus || (result.hasLesion ? '需关注' : '正常')}}</text></text>
      <text class="result-time">分析时间：{{result.time}}</text>
      
      <!-- 置信度显示 -->
      <view class="confidence-section" wx:if="{{result.confidence > 0}}">
        <text class="confidence-label">分析置信度：</text>
        <view class="confidence-bar">
          <view class="confidence-fill" style="width: {{result.confidence * 100}}%"></view>
        </view>
        <text class="confidence-value">{{confidencePercentage}}%</text>
      </view>
    </view>

    <!-- 扫描图片 -->
    <view class="images-section">
      <text class="section-label">扫描图片</text>
      <view class="images-grid">
        <view class="image-item" wx:for="{{result.images}}" wx:key="index" bind:tap="previewImage">
          <image src="{{item}}" mode="aspectFill" class="scan-image" />
        </view>
      </view>
    </view>

    <!-- 分析详情 -->
    <view class="analysis-section">
      <text class="section-label">耳部结构识别</text>
      <view class="structure-list">
        <view class="structure-item" wx:for="{{result.structures}}" wx:key="name">
          <text class="structure-name">{{item.name}}</text>
          <t-tag theme="{{item.status === '正常' ? 'success' : 'warning'}}" size="small">{{item.status}}</t-tag>
        </view>
      </view>
    </view>

    <!-- 可见结构 -->
    <view class="analysis-section" wx:if="{{result.visibleStructures && result.visibleStructures.length > 0}}">
      <text class="section-label">可见耳部结构</text>
      <view class="tag-list">
        <t-tag wx:for="{{result.visibleStructures}}" wx:key="index" theme="primary" size="small">{{item}}</t-tag>
      </view>
    </view>

    <!-- 异常发现 -->
    <view class="analysis-section" wx:if="{{result.abnormalFindings && result.abnormalFindings.length > 0}}">
      <text class="section-label">异常发现</text>
      <view class="findings-list">
        <view class="finding-item" wx:for="{{result.abnormalFindings}}" wx:key="index">
          <t-icon name="warning" size="16px" color="#faad14" />
          <text class="finding-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- 可能病症 -->
    <view class="analysis-section" wx:if="{{result.possibleConditions && result.possibleConditions.length > 0}}">
      <text class="section-label">可能病症</text>
      <view class="conditions-list">
        <view class="condition-item" wx:for="{{result.possibleConditions}}" wx:key="index">
          <t-icon name="info-circle" size="16px" color="#1890ff" />
          <text class="condition-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- 异常描述 -->
    <view class="analysis-section">
      <text class="section-label">分析结论</text>
      <view class="abnormal-box {{result.hasLesion ? 'warning' : 'success'}}">
        <text>{{result.abnormal || '未发现明显异常，所有结构均在正常范围内。'}}</text>
      </view>
    </view>
  </view>

  <!-- 健康建议 -->
  <view class="section">
    <text class="section-title">健康建议</text>
    <view class="suggestion-list">
      <text class="suggestion-item" wx:for="{{suggestions}}" wx:key="index">• {{item}}</text>
    </view>
  </view>

  <!-- 免责声明 -->
  <view class="disclaimer-section" wx:if="{{result.disclaimer}}">
    <text class="disclaimer-title">免责声明</text>
    <text class="disclaimer-text">{{result.disclaimer}}</text>
  </view>

  <!-- 下一步行动 -->
  <view class="section">
    <text class="section-title">下一步行动</text>
    <view class="action-buttons">
      <t-button theme="primary" size="large" bind:tap="saveRecord">保存到健康记录</t-button>
      <t-button theme="default" size="large" bind:tap="shareToDoctor">分享给医生咨询</t-button>
      <t-button theme="default" size="large" bind:tap="bookCheckup">预约专业检查</t-button>
      <t-button theme="default" size="large" bind:tap="rescan">重新扫描</t-button>
    </view>
  </view>

  <!-- 历史对比 -->
  <view class="section">
    <text class="section-title">与上次对比</text>
    <t-cell-group>
      <t-cell title="上次扫描时间" note="{{comparison.lastTime}}" />
      <t-cell title="上次结果">
        <t-tag slot="right-icon" theme="{{comparison.lastStatus === '正常' ? 'success' : 'warning'}}" size="small">{{comparison.lastStatus}}</t-tag>
      </t-cell>
      <t-cell title="变化趋势">
        <text slot="right-icon" class="trend-text {{comparison.trend === '有所改善' ? 'success' : comparison.trend === '情况变差' ? 'warning' : 'default'}}">{{comparison.trend}}</text>
      </t-cell>
    </t-cell-group>
  </view>
</view>

